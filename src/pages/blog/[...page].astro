---
import type { Page } from 'astro';
import BlogList from '../../components/blog/list.astro';
import BlogPagination from '../../components/blog/pagination.astro';
import PaginatedLayout, {
  type PaginatedProps
} from '../../layouts/Paginated.astro';
import { getCollection, getEntry, type CollectionEntry } from 'astro:content';

type Props = {
  page: Page<CollectionEntry<'blog'>>;
};

export async function getStaticPaths({ paginate }: { paginate: Function }) {
  const posts = await getCollection('blog');
  const page = await getEntry('pages', 'blog');
  const filteredPosts = posts.filter((p) => (p.data.language ?? 'en') === 'en');
  return paginate(filteredPosts, {
    pageSize: page?.data && 'page_size' in page.data ? page.data.page_size : 6
  });
}

const page = await getEntry('pages', 'blog');
const frontmatter = page?.data as PaginatedProps['frontmatter'];
const pagination = Astro.props.page;
const { data: posts } = pagination;
---

<PaginatedLayout frontmatter={frontmatter}>
  <section class="blog-index mx-auto flex flex-col justify-center">
    <BlogList posts={posts} />
    <BlogPagination pagination={pagination} />
  </section>
</PaginatedLayout>

<style>
  .blog-index {
    max-width: var(--pageContainer);
    padding-inline: var(--pagePadding);
  }
</style>
