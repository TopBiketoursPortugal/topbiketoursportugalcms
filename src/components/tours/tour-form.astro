---
import Form from '../form/Form.astro';
import FormField from '../form/FormField.astro';
---

<script is:inline src="https://www.google.com/recaptcha/api.js"></script>
<!-- <script is:inline>
  function onSubmit(token) {
    document.getElementById('tour-form').submit();
  }
</script> -->
<Form action="https://formspree.io/xzbalqpw" method="post" id="tour-form">
  <FormField
    as="input"
    name="name"
    required
    placeholder="Your full name"
    label="Name"
  />
  <FormField
    as="input"
    name="email"
    type="email"
    required
    placeholder="your@email.com"
    label="Email Address"
  />
  <FormField
    as="input"
    name="phone"
    required
    type="phone"
    placeholder="Your phone number with international code"
    label="Phone"
  />
  <FormField
    as="input"
    type="date"
    name="tour-date"
    required
    label="Tour Date"
  />
  <FormField as="textarea" name="enquiry" required label="Your Enquiry" />
  <FormField
    as="textarea"
    rows="2"
    name="enquiry"
    label="Where did you find us?"
    placeholder="Optional - how you heard about us"
  />

  <FormField
    as="select"
    options={['Guided', 'Unguided']}
    name="tour-type"
    label="Select tour type"
    placeholder="Optional - how you heard about us"
  />

  <FormField
    as="input"
    name="phone"
    type="number"
    min="1"
    max="10"
    label=" Number of Persons"
  />

  <FormField
    as="input"
    name="country"
    type="text"
    min="1"
    max="10"
    label="Country"
    placeholder="Your country"
  />

  <!-- Terms Checkbox with Modal Trigger -->
  <div class="flex items-center">
    <input
      type="checkbox"
      id="terms"
      name="terms"
      required
      aria-required="true"
      class="peer h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500 dark:border-gray-600 dark:bg-gray-700"
    />
    <label for="terms" class="ml-2 text-sm text-gray-700 dark:text-gray-200">
      I accept the
      <label
        for="terms-toggle"
        class="cursor-pointer text-blue-600 hover:underline dark:text-blue-400"
      >
        terms and conditions
      </label>
      <span aria-hidden="true">*</span>
      <span class="sr-only">(required)</span>
    </label>
  </div>

  <!-- Submit Button -->
  <div>
    <button
      data-sitekey="reCAPTCHA_site_key"
      data-callback="onSubmit"
      data-action="submit"
      type="submit"
      class="g-recaptcha w-full rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
    >
      Submit Enquiry
    </button>
  </div>
</Form>

<!-- Modal Trigger Checkbox (hidden) -->
<input type="checkbox" id="terms-toggle" class="peer hidden" aria-hidden />

<!-- Terms and Conditions Modal -->
<div
  class="fixed inset-0 z-50 hidden items-center justify-center bg-gray-600 bg-opacity-50 transition-opacity duration-300 peer-checked:flex"
>
  <div
    class="max-h-[80vh] w-full max-w-lg transform overflow-y-auto rounded-lg bg-white p-6 shadow-xl transition-all duration-300 dark:bg-gray-800"
  >
    <div class="mb-4 flex items-center justify-between">
      <h2 class="text-xl font-bold text-gray-900 dark:text-white">
        Terms and Conditions
      </h2>
      <label
        for="terms-toggle"
        class="cursor-pointer text-2xl text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
      >
        Ã—
      </label>
    </div>

    <div
      class="peer-check:flex space-y-4 text-gray-700 peer-checked:opacity-100 dark:text-gray-200"
    >
      <p>By submitting this form, you agree to the following terms:</p>
      <ul class="list-disc space-y-2 pl-5">
        <li>All bookings are subject to availability</li>
        <li>Payment must be completed 48 hours before tour date</li>
        <li>Cancellations within 24 hours are non-refundable</li>
        <li>We reserve the right to modify tour schedules</li>
        <li>
          Personal information will be handled according to our privacy policy
        </li>
      </ul>
      <p>For full terms, please contact our support team.</p>
    </div>

    <div class="mt-6 flex justify-end">
      <label
        for="terms-toggle"
        class="cursor-pointer rounded-md bg-blue-600 px-4 py-2 text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-gray-800"
      >
        Close
      </label>
    </div>
  </div>
</div>

<style>
  /* Custom validation styles */
  input:invalid:focus,
  textarea:invalid:focus,
  select:invalid:focus {
    border-color: #ef4444;
    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2);
  }
</style>
